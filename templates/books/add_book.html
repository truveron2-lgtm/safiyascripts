{% extends 'base_admin.html' %}
{% load static %}

{% block title %}Add Book | SafiyaScripts{% endblock %}

{% block extra_css %}
<style>
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 2rem;
  }
  th, td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #dee2e6;
    text-align: left;
  }
  th {
    background-color: #f8f9fa;
    font-weight: 600;
  }
  tr:hover {
    background-color: #f1f1f1;
  }
  .action-btns a, .action-btns form {
    display: inline-block;
    margin-right: 5px;
  }
  .action-btns .btn {
    font-size: 0.875rem;
    padding: 0.35rem 0.75rem;
  }
  .card form {
    max-width: 600px;
    margin: 0 auto;
  }
  .card form p {
    margin-bottom: 1.5rem;
  }
  .card form label {
    font-weight: 600;
    margin-bottom: 0.5rem;
    display: block;
    color: #333;
  }
  .card form input[type="text"],
  .card form textarea,
  .card form input[type="file"] {
    width: 100%;
    padding: 0.6rem 0.75rem;
    border-radius: 6px;
    border: 1px solid #ced4da;
    font-size: 1rem;
    box-sizing: border-box;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  .card form input[type="text"]:focus,
  .card form textarea:focus,
  .card form input[type="file"]:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
    outline: none;
  }
  .card form textarea {
    min-height: 150px;
    resize: vertical;
  }
  .card form button {
    display: block;
    width: 100%;
    font-size: 1.1rem;
    padding: 0.5rem;
    border-radius: 6px;
    transition: background-color 0.3s;
  }
  .card form button:hover {
    background-color: #0056b3;
    color: #fff;
  }
  .card {
    border-radius: 10px;
    padding: 2rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
  .container h2 {
    font-weight: 700;
    color: #212529;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
  <h2 class="text-center mb-5">Book Management</h2>

  <!-- ✅ Book Table -->
  <div class="mb-5">
    <h4 class="mb-3">All Books</h4>
    {% if books %}
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Published At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for book in books %}
            <tr>
              <td>{{ book.title }}</td>
              <td>{{ book.author }}</td>
              <td>{{ book.published_at|date:"M d, Y" }}</td>
              <td class="action-btns">
                {% if request.user.is_authenticated %}
                  <a href="{% url 'edit_book' book.pk %}" class="btn btn-outline-warning btn-sm">Edit</a>
                  <form action="{% url 'delete_book' book.pk %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-danger btn-sm"
                            onclick="return confirm('Are you sure you want to delete this book?');">
                      Delete
                    </button>
                  </form>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">No books added yet.</p>
    {% endif %}
  </div>

  <!-- ✅ Add / Edit Form -->
  <div class="card">
    <h4 class="mb-4 text-center">
      {% if edit_mode %}Edit Book: {{ book.title }}{% else %}Add a New Book{% endif %}
    </h4>
    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" class="btn btn-primary mt-3">
        {% if edit_mode %}Update Book{% else %}Save Book{% endif %}
      </button>
    </form>
  </div>
</div>
{% endblock %}
