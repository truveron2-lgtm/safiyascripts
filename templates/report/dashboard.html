{% extends 'base_admin.html' %}

{% block title %}Reports & Analytics | SafiyaScripts{% endblock %}

{% block extra_css %}
<style>
body {
    background-color: #faf8ff;
}
.dashboard-header {
    text-align: center;
    margin-bottom: 2rem;
}
.card {
    border-radius: 15px;
    border: none;
    color: #fff;
}
.card-users { background: linear-gradient(135deg, #6a11cb, #2575fc); }
.card-articles { background: linear-gradient(135deg, #ff758c, #ff7eb3); }
.card-books { background: linear-gradient(135deg, #43cea2, #185a9d); }
.card-subscribers { background: linear-gradient(135deg, #ffb347, #ffcc33); }
.card h4 { margin-bottom: 0; }
.search-filter {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1.5rem;
}
.search-filter input, .search-filter select {
    padding: 0.5rem;
    border-radius: 5px;
    border: 1px solid #ccc;
    width: 48%;
}
.table th {
    background-color: #f3e5f5;
    color: #4b0082;
}
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="dashboard-header">
    <h2 class="fw-bold text-primary">Reports & Analytics</h2>
    <p class="text-muted">Monitor and manage users, articles, books, and subscribers</p>
  </div>

  <div class="row mb-4 text-center">
    <div class="col-md-3 mb-3">
      <div class="card card-users p-3">
        <h4>Users</h4>
        <h2>{{ total_users }}</h2>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card card-articles p-3">
        <h4>Articles</h4>
        <h2>{{ total_articles }}</h2>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card card-books p-3">
        <h4>Books</h4>
        <h2>{{ total_books }}</h2>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card card-subscribers p-3">
        <h4>Subscribers</h4>
        <h2>{{ total_subscribers }}</h2>
      </div>
    </div>
  </div>

  <div class="search-filter">
    <input type="text" placeholder="Search records...">
    <select>
      <option>Filter by Category</option>
      <option>Users</option>
      <option>Articles</option>
      <option>Books</option>
      <option>Subscribers</option>
    </select>
  </div>

  <div class="mb-4">
    <canvas id="statsChart"></canvas>
  </div>

  <h4 class="mt-4">Recent Articles</h4>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Title</th><th>Author</th><th>Date</th>
      </tr>
    </thead>
    <tbody>
      {% for article in recent_articles %}
      <tr>
        <td>{{ article.title }}</td>
        <td>{{ article.author }}</td>
        <td>{{ article.created_at|date:"M d, Y" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="3">No articles found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('statsChart');
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Users', 'Articles', 'Books', 'Subscribers'],
        datasets: [{
            label: 'Site Overview',
            data: [{{ total_users }}, {{ total_articles }}, {{ total_books }}, {{ total_subscribers }}],
            backgroundColor: ['#6a11cb', '#ff758c', '#43cea2', '#ffb347']
        }]
    },
    options: { responsive: true, plugins: { legend: { display: false } } }
});
</script>
{% endblock %}
